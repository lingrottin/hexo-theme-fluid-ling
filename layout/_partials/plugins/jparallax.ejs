<% 
    function parseParallaxImages(){
    if(page.parallax_images){return page.parallax_images;}
    else if(page.banner_img){return [{"source": page.banner_img, "size": theme.banner.parallax.images[0].size || '120%'}];}
    else if(theme.banner.parallax.images){return theme.banner.parallax.images;}
    else{return [{"source": theme.index.banner_img, "size": '120%'}];}
    }
    var parallaxImages=parseParallaxImages();
    var jParallaxArg=new String();
    parallaxImages.forEach(function(imgObject){
        jParallaxArg+=', {';
        if((imgObject.yparallax || 'auto') != 'auto'){
            jParallaxArg+=`yparallax: "${imgObject.yparallax}"` ;
        }
        if((imgObject.xparallax || 'auto') != 'auto'){
            jParallaxArg+=`, xparallax: "${imgObject.xparallax}"` ;
        }
        jParallaxArg+=" }";
    });
    import_script(`<script type="text/javascript" src="${ theme.static_prefix.internal_js + '/jquery.parallax.js'}"></script>
<script type="text/javascript">function initjParallax(_resize) {
	if (_resize) { jQuery('.jparallax-layer').unparallax(); }
	jQuery('.jparallax-layer').parallax({} ${jParallaxArg});
};
window.addEventListener("resize", function () { // 不用 jQuery 的事件是因为 jq 在窗口大小变化完成之后调用，会使图像不自然
	console.log("resize");
	initjParallax(true)
});
$(document).ready(initjParallax(false));</script>`);
%>